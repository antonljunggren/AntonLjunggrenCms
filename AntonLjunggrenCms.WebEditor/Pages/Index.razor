@page "/"
@using AntonLjunggrenCms.Data.Entites;
@using AntonLjunggrenCms.Data.Persistance;
@using AntonLjunggrenCms.Data.Services;
@using AntonLjunggrenCms.WebEditor.Data;
@using Microsoft.JSInterop
@inject IRepository<PhotographEntity, string> _photographRepository;
@inject IFileService _fileService;
@inject PhotographService _photographService;
@inject IJSRuntime JSRuntime

<PageTitle>Index</PageTitle>

<h1>All photographs</h1>

<div>
    @foreach(var photo in photos)
    {
        <div>
            <img class="photo-preview" id="@photo.Id" src="@previewImages[photo.Id]" alt="@photo.Title" />
            <h2>@photo.Title</h2>
        </div>
    }
</div>


@code {
    private List<PhotographEntity> photos = new List<PhotographEntity>();
    private Dictionary<string, string> previewImages = new Dictionary<string, string>();

    protected override async Task OnInitializedAsync()
    {
        var photosRes = await _photographService.GetPhotos();

        foreach (var photo in photosRes)
        {
            var image = await _photographService.GetImage(photo.Id);
            previewImages.Add(photo.Id, image);
            photos.Add(photo);
        }
    }
}
